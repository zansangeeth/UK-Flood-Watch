/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import"../../has.js";import e from"../../Logger.js";import{beforeDestroySymbol as t}from"../beforeDestroy.js";import{Lifecycle as r}from"../Lifecycle.js";import{getPropertiesMetadata as o}from"../metadata.js";import{trackAccess as s}from"../tracking.js";import{processPrototypePropertyMetadata as i}from"../extensions/serializableProperty.js";const n=new Set,c=new Set;function a(e){return s=>{e??="esri.core.Accessor",s.prototype.declaredClass=e,p(s);const i=[],a=[];let l=s.prototype;for(;l;)l.hasOwnProperty("initialize")&&!n.has(l.initialize)&&(n.add(l.initialize),i.push(l.initialize)),l.hasOwnProperty("destroy")&&!c.has(l.destroy)&&(c.add(l.destroy),a.push(l.destroy)),l=Object.getPrototypeOf(l);n.clear(),c.clear();const f=class extends s{constructor(...e){if(super(...e),this.constructor===f&&"function"==typeof this.postscript){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let e=i.length-1;e>=0;e--)i[e].call(this)}}),a.length){let e=!1;const o=this[t];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!e){this.__accessor__.lifecycle=r.DESTROYING,e=!0,o.call(this);for(let e=0;e<a.length;e++)a[e].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};f.__accessorMetadata__=o(s.prototype),f.prototype.declaredClass=e;const u=(e||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(f,"name",{value:u,configurable:!0}),f}}function l(e,t){return null==t.get?function(){const t=this.__accessor__,r=t.propertiesByName.get(e);if(void 0===r)return;t.mutable&&s(r);const o=t.store;return o.has(e)?o.get(e):r.metadata.value}:function(){const t=this.__accessor__,r=t.propertiesByName.get(e);if(void 0!==r)return r.getComputed(t)}}function p(e){const t=e.prototype,s=o(t),n={};for(const o of Object.getOwnPropertyNames(s)){const e=s[o];i(e),n[o]={enumerable:!0,configurable:!0,get:l(o,e),set(t){const s=this.__accessor__;if(void 0!==s){if(s.mutable)return s.initialized&&e.readOnly?f("read-only",o):s.lifecycle===r.CONSTRUCTED&&e.constructOnly?f("construct-only",o):void s.set(o,t)}else Object.defineProperty(this,o,{enumerable:!0,configurable:!0,writable:!0,value:t})}}}Object.defineProperties(e.prototype,n)}const f=(t,r)=>{e.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${r}'`)};export{p as finalizeClass,a as subclass};
