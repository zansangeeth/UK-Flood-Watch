/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as o}from"tslib";import t from"../../../core/Accessor.js";import{isSome as e}from"../../../core/arrayUtils.js";import r from"../../../core/Collection.js";import{watch as i,initial as s}from"../../../core/reactiveUtils.js";import{property as n}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/Logger.js";import{subclass as d}from"../../../core/accessorSupport/decorators/subclass.js";import a from"../FilterCondition.js";import{defaultOperatorNamesByFieldType as l}from"../FilterCondition/conditionUtils.js";let p=class extends t{constructor(o){super(o),this.conditionOperator="AND",this.conditionWidgets=new r,this.layer=null,this.operators=l}initialize(){this.addHandles([i(()=>this.layer,async o=>{o&&!o.loaded&&await o.load()},s)])}get count(){return this.conditionWidgets.length}get state(){const{layer:o}=this;return o?o.loaded?"ready":"loading":"disabled"}get whereClause(){const{conditionOperator:o,whereClauses:t}=this;let e="";return t.forEach((t,r)=>{e+=r>0?` ${o} (${t})`:`(${t})`}),e}get whereClauses(){return this.conditionWidgets.toArray().map(o=>o.whereClause).filter(e)}addCondition(o,t){const{layer:e,operators:r}=this;e&&this.conditionWidgets.add(new a({...o,layer:e,operators:r}),t)}duplicateCondition(o){const t=this.conditionWidgets.at(o);if(!t)return;const{fieldName:e,operator:r,value:i}=t;this.addCondition({fieldName:e,operator:r,value:i})}reset(){this.conditionWidgets.removeAll()}removeCondition(o){null==o?this.conditionWidgets.pop():this.conditionWidgets.splice(o,1)}};o([n()],p.prototype,"conditionOperator",void 0),o([n()],p.prototype,"conditionWidgets",void 0),o([n()],p.prototype,"count",null),o([n()],p.prototype,"layer",void 0),o([n()],p.prototype,"operators",void 0),o([n()],p.prototype,"state",null),o([n()],p.prototype,"whereClause",null),o([n()],p.prototype,"whereClauses",null),p=o([d("esri.widgets.support.FilterBuilder.FilterBuilderViewModel")],p);export{p as default};
