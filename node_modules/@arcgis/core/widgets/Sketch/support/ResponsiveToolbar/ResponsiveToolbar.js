/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import{isSome as r}from"../../../../core/arrayUtils.js";import{destroyMaybe as t}from"../../../../core/maybe.js";import{property as a}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/Logger.js";import{subclass as o}from"../../../../core/accessorSupport/decorators/subclass.js";import s from"../../../Widget.js";import i from"./MeasuredContentGroup.js";import l from"./OverflowGroup.js";import n from"./ResponsiveToolbarManager.js";import{SplitButton as d}from"./SplitButton.js";import{loadCalciteComponents as c}from"../../../support/componentsUtils.js";import"../../../support/widgetUtils.js";import{tsx as p}from"../../../support/jsxFactory.js";import"@arcgis/toolkit/dom";const m="esri-responsive-toolbar",u={rulerBase:`${m}__ruler`,rulerBarHorizontal:`${m}__ruler--bar`,rulerBarVertical:`${m}__ruler--bar--vertical`,rulerPadVertical:`${m}__ruler--pad--vertical`,rulerPadHorizontal:`${m}__ruler--pad--horizontal`,bar:`${m}__bar`,barHorizontal:`${m}__bar--horizontal`,barVertical:`${m}__bar--vertical`,pad:`${m}__pad`,padVertical:`${m}__pad--vertical`,padHorizontal:`${m}__pad--horizontal`};let h=class extends s{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new n,this._managedWidgets=new Map}loadDependencies(){return c({"action-bar":()=>import("@esri/calcite-components/dist/components/calcite-action-bar")})}destroy(){this._measurementManager=t(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const r=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),r!==e&&this.scheduleRender()}get _barClasses(){const e="docked"===this.barStyle,r="vertical"===this.layout;return{[u.barHorizontal]:e&&!r,[u.barVertical]:e&&r,[u.bar]:e,[u.padHorizontal]:!e&&!r,[u.padVertical]:!e&&r,[u.pad]:!e}}render(){const{layout:e,scale:r,barStyle:t}=this,a={layout:e,scale:r,expandDisabled:!0,key:"measured-toolbar"},o="docked"===t?"vertical"===e?u.rulerBarVertical:u.rulerBarHorizontal:"horizontal"===e?u.rulerPadHorizontal:u.rulerPadVertical;return p("div",null,p("div",{afterCreate:e=>{this._measurementManager?.connect(e)},class:this.classes(u.rulerBase,o)}),p("calcite-action-bar",{...a,classes:this._barClasses,floating:"docked"!==t,overflowActionsDisabled:!0},this._renderChildren()))}_renderChildren(){if(!this.children)return;const e=this.children.filter(e=>void 0!==e.properties?.key&&"group-kind"in e.properties),t=new Set,a=e.map(e=>{const r=e.properties,a=r.key;t.add(a);const o="docked"===this.barStyle?r.slot??void 0:void 0,s=r.priority??0,n=r["group-kind"]??"overflow-group",c=r["allow-collapse"]??!0,p=this._managedWidgets.get(a);if(p)return p.children=e.children,p.priority=s,"allowCollapse"in p&&(p.allowCollapse=c),p.slot=o,p.layout=this.layout,p.scale=this.scale,p.measurementManager=this._measurementManager,p;const m={scale:this.scale,priority:s,measurementManager:this._measurementManager,children:e.children,slot:o,layout:this.layout};switch(n){case"split-button":{const e=new d({...m,allowCollapse:c});return this._managedWidgets.set(a,e),e}case"overflow-group":{const e=new l({...m,allowCollapse:c});return this._managedWidgets.set(a,e),e}case"measured-content":{const e=new i({...m});return this._managedWidgets.set(a,e),e}}}).filter(r);return Array.from(this._managedWidgets.keys()).filter(e=>!t.has(e)).forEach(e=>{this._managedWidgets.get(e)?.destroy(),this._managedWidgets.delete(e)}),this._measurementManager?.allocate(),a.map(e=>e.render())}};e([a()],h.prototype,"scale",void 0),e([a({value:"horizontal"})],h.prototype,"layout",null),e([a()],h.prototype,"barStyle",void 0),e([a()],h.prototype,"_measurementManager",void 0),e([a()],h.prototype,"_managedWidgets",void 0),e([a()],h.prototype,"_barClasses",null),h=e([o("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],h);export{h as default};
