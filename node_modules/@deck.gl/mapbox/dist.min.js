(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var he=Object.create;var C=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var me=Object.getOwnPropertyNames;var ye=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty;var Me=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),be=(t,e)=>{for(var o in e)C(t,o,{get:e[o],enumerable:!0})},O=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of me(e))!ge.call(t,n)&&n!==o&&C(t,n,{get:()=>e[n],enumerable:!(r=fe(e,n))||r.enumerable});return t},m=(t,e,o)=>(O(t,e,"default"),o&&O(o,e,"default")),y=(t,e,o)=>(o=t!=null?he(ye(t)):{},O(e||!t||!t.__esModule?C(o,"default",{value:t,enumerable:!0}):o,t)),ve=t=>O(C({},"__esModule",{value:!0}),t);var d=Me((Ue,J)=>{J.exports=globalThis.deck});var T={};be(T,{MapboxOverlay:()=>I});var u={},K=y(d(),1);m(u,y(d(),1));if(!K.Layer)throw new Error("@deck.gl/core is not found");m(T,u);var M=y(d(),1);var h=y(d(),1);function F(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var g=Math.PI,we=g/4,G=g/180,He=180/g,V=512,De=4003e4;function v(t){let[e,o]=t;F(Number.isFinite(e)),F(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude");let r=e*G,n=o*G,l=V*(r+g)/(2*g),s=V*(g+Math.log(Math.tan(we+n*.5)))/(2*g);return[l,s]}function N(t){let e=Math.cos(t*G);return V/De/e}var rt=Math.PI/180;var D="mapbox",A=512,Ge=Math.PI/180;function _({map:t,gl:e,deck:o}){if(t.__deck)return t.__deck;let r=o?.props._customRender,n=o?.props.onLoad,l={...o?.props,_customRender:()=>{t.triggerRepaint(),r?.("")}};l.parameters={...P(t,!0),...l.parameters},l.views||=x(t);let s;return(!o||o.props.gl===e)&&(Object.assign(l,{gl:e,width:null,height:null,touchAction:"unset",viewState:L(t)}),o?.isInitialized?te(o,t):l.onLoad=()=>{n?.(),te(s,t)}),o?(s=o,o.setProps(l),o.userData.isExternal=!0):(s=new h.Deck(l),t.on("remove",()=>{Z(t)})),s.userData.mapboxLayers=new Set,t.__deck=s,t.on("render",()=>{s.isInitialized&&Ne(s,t)}),s}function te(t,e){let o=()=>{t.isInitialized?Ae(t,e):e.off("move",o)};e.on("move",o)}function Z(t){t.__deck?.finalize(),t.__deck=null}function P(t,e){let o=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return R(t)==="globe"&&(o.cullMode="back"),o}function oe(t,e){t.userData.mapboxLayers.add(e),B(t)}function re(t,e){t.userData.mapboxLayers.delete(e),B(t)}function ne(t,e){B(t)}function se(t,e,o,r){let{currentViewport:n}=t.userData,l=!1;n||(n=U(t,e,r),t.userData.currentViewport=n,l=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:s=>(!t.props.layerFilter||t.props.layerFilter(s))&&(o.id===s.layer.id||s.layer.props.operation.includes("terrain")),clearStack:l,clearCanvas:!1})}function ie(t,e,o,r){let{currentViewport:n}=t.userData,l=!1;n||(n=U(t,e,r),t.userData.currentViewport=n,l=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:s=>{if(t.props.layerFilter&&!t.props.layerFilter(s))return!1;let i=s.layer;return i.props.beforeId===o.beforeId&&i.props.slot===o.slot},clearStack:l,clearCanvas:!1})}function R(t){let e=t.getProjection?.(),o=e?.type||e?.name;if(o==="globe")return"globe";if(o&&o!=="mercator")throw new Error("Unsupported projection");return"mercator"}function x(t){return R(t)==="globe"?new h._GlobeView({id:D}):new h.MapView({id:D})}function L(t){let{lng:e,lat:o}=t.getCenter(),r={longitude:(e+540)%360-180,latitude:o,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return t.getTerrain?.()&&Ve(t,r),r}function Ve(t,e){if(t.getFreeCameraOptions){let{position:o}=t.getFreeCameraOptions();if(!o||o.z===void 0)return;let r=t.transform.height,{longitude:n,latitude:l,pitch:s}=e,i=o.x*A,a=(1-o.y)*A,c=o.z*A,p=v([n,l]),f=i-p[0],b=a-p[1],j=Math.sqrt(f*f+b*b),S=s*Ge,z=1.5*r,$=S<.001?z*Math.cos(S)/c:z*Math.sin(S)/j;e.zoom=Math.log2($);let ue=z*Math.cos(S)/$,de=c-ue;e.position=[0,0,de/N(l)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function U(t,e,o){let r=L(e),{views:n}=t.props,l=n&&(0,h._flatten)(n).find(a=>a.id===D)||x(e);o&&(l.props.nearZMultiplier=.2);let s=o?.nearZ??e.transform._nearZ,i=o?.farZ??e.transform._farZ;return Number.isFinite(s)&&(r.nearZ=s/e.transform.height,r.farZ=i/e.transform.height),l.makeViewport({width:t.width,height:t.height,viewState:r})}function Ne(t,e){let{mapboxLayers:o,isExternal:r}=t.userData;if(r){let n=Array.from(o,p=>p.id),s=(0,h._flatten)(t.props.layers,Boolean).some(p=>p&&!n.includes(p.id)),i=t.getViewports(),a=i.findIndex(p=>p.id===D),c=i.length>1||a<0;(s||c)&&(a>=0&&(i=i.slice(),i[a]=U(t,e)),t._drawLayers("mapbox-repaint",{viewports:i,layerFilter:p=>(!t.props.layerFilter||t.props.layerFilter(p))&&(p.viewport.id!==D||!n.includes(p.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function Ae(t,e){t.setProps({viewState:L(e)}),t.needsRedraw({clearRedrawFlags:!0})}function B(t){if(t.userData.isExternal)return;let e=[];t.userData.mapboxLayers.forEach(o=>{let r=o.props.type,n=new r(o.props);e.push(n)}),t.setProps({layers:e})}var pe=y(d(),1);var W=y(d(),1);var k=class{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,o){this.map=e,this.deck=_({map:e,gl:o,deck:this.props.deck}),oe(this.deck,this)}onRemove(){this.deck&&re(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&ne(this.deck,this)}render(e,o){se(this.deck,this.map,this,o)}};var X="__UNDEFINED__";function ae(t,e,o,r){if(!t||!e||!t.style||!t.style._loaded)return;let n=(0,W._flatten)(r,Boolean);if(o!==r){let i=(0,W._flatten)(o,Boolean),a=new Set(i.map(c=>c.id));for(let c of n)a.delete(c.id);for(let c of a)t.getLayer(c)&&t.removeLayer(c)}for(let i of n){let a=t.getLayer(i.id);a?(a.implementation||a).setProps(i.props):t.addLayer(new k({id:i.id,deck:e,slot:i.props.slot}),i.props.beforeId)}let l=t.style._order,s={};for(let i of n){let{beforeId:a}=i.props;(!a||!l.includes(a))&&(a=X),s[a]=s[a]||[],s[a].push(i.id)}for(let i in s){let a=s[i],c=i===X?l.length:l.indexOf(i),p=i===X?void 0:i;for(let f=a.length-1;f>=0;f--){let b=a[f],j=l.indexOf(b);j!==c-1&&(t.moveLayer(b,p),j>c&&c++),c--,p=b}}}var H=y(d(),1);var ce=y(d(),1),E=class{constructor(e){(0,ce.assert)(e.id,"id is required"),this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.beforeId=e.beforeId,this.map=null,this.deck=null}onAdd(e,o){this.map=e,this.deck=_({map:e,gl:o})}render(e,o){!this.deck||!this.map||ie(this.deck,this.map,this,o)}};var Y="__UNDEFINED__";function q(t){return t.props.beforeId?`deck-layer-group-before:${t.props.beforeId}`:t.props.slot?`deck-layer-group-slot:${t.props.slot}`:"deck-layer-group-last"}function le(t,e,o){if(!t||!t.style||!t.style._loaded)return;let r=(0,H._flatten)(o,Boolean);if(e!==o){let s=(0,H._flatten)(e,Boolean),i=new Set(s.map(c=>q(c))),a=new Set(r.map(c=>q(c)));for(let c of i)a.has(c)||t.getLayer(c)&&t.removeLayer(c)}let n={};for(let s of r){let i=q(s),a=t.getLayer(i);if(a){let c=a.implementation||a;n[i]=c}else{let c=new E({id:i,slot:s.props.slot,beforeId:s.props.beforeId});n[i]=c,t.addLayer(c,s.props.beforeId)}}let l=t.style._order;for(let[s,i]of Object.entries(n)){let a=i.beforeId||Y,c=a===Y?l.length:l.indexOf(a);if(l.indexOf(s)!==c-1){let f=a===Y?void 0:a;t.moveLayer(s,f)}}}var I=class{constructor(e){this._handleStyleChange=()=>{if(this._resolveLayers(this._map,this._deck,this._props.layers,this._props.layers),!this._map)return;R(this._map)&&!this._props.views&&this._deck?.setProps({views:x(this._map)})};this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:e,clientHeight:o}=this._map.getContainer();Object.assign(this._container.style,{width:`${e}px`,height:`${o}px`})}};this._updateViewState=()=>{let e=this._deck,o=this._map;e&&o&&(e.setProps({views:this._props.views||x(o),viewState:L(o)}),e.isInitialized&&e.redraw())};this._handleMouseEvent=e=>{let o=this._deck;if(!o||!o.isInitialized)return;let r={type:e.type,offsetCenter:e.point,srcEvent:e},n=this._lastMouseDownPoint;switch(!e.point&&n&&(r.deltaX=e.originalEvent.clientX-n.clientX,r.deltaY=e.originalEvent.clientY-n.clientY,r.offsetCenter={x:n.x+r.deltaX,y:n.y+r.deltaY}),r.type){case"mousedown":o._onPointerDown(r),this._lastMouseDownPoint={...e.point,clientX:e.originalEvent.clientX,clientY:e.originalEvent.clientY};break;case"dragstart":r.type="panstart",o._onEvent(r);break;case"drag":r.type="panmove",o._onEvent(r);break;case"dragend":r.type="panend",o._onEvent(r);break;case"click":r.tapCount=1,o._onEvent(r);break;case"dblclick":r.type="click",r.tapCount=2,o._onEvent(r);break;case"mousemove":r.type="pointermove",o._onPointerMove(r);break;case"mouseout":r.type="pointerleave",o._onPointerMove(r);break;default:return}};let{interleaved:o=!1}=e;this._interleaved=o,this._renderLayersInGroups=e._renderLayersInGroups||!1,this._props=this.filterProps(e)}filterProps(e){let{interleaved:o=!1,useDevicePixels:r,...n}=e;return!o&&r!==void 0&&(n.useDevicePixels=r),n}setProps(e){this._interleaved&&e.layers&&this._resolveLayers(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,this.filterProps(e)),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...P(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){let o=document.createElement("div");return Object.assign(o.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=o,this._deck=new M.Deck({...this._props,parent:o,parameters:{...P(e,!1),...this._props.parameters},views:this._props.views||x(e),viewState:L(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),o}_onAddInterleaved(e){let o=e.painter.context.gl;return o instanceof WebGLRenderingContext&&pe.log.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=_({map:e,gl:o,deck:new M.Deck({...this._props,gl:o,parameters:{...P(e,!0),...this._props.parameters}})}),e.on("styledata",this._handleStyleChange),this._resolveLayers(e,this._deck,[],this._props.layers),document.createElement("div")}_resolveLayers(e,o,r,n){this._renderLayersInGroups?le(e,r,n):ae(e,o,r,n)}onRemove(){let e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),this._resolveLayers(e,this._deck,this._props.layers,[]),Z(e)}getDefaultPosition(){return"top-left"}pickObject(e){return(0,M.assert)(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return(0,M.assert)(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return(0,M.assert)(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}};return ve(T);})();
      return __exports__;
      });
