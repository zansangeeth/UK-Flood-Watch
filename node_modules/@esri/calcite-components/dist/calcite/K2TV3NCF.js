/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.3.3 */
import{g as X}from"./6JIV4E45.js";import{l as K}from"./6LYLG6DT.js";import{a as $}from"./KGCNPVC5.js";import{c as J,d as Q}from"./2PVHLGVY.js";import{c as H,e as W,f as j,h as A}from"./6QIKWEZF.js";import{a as G,b as q}from"./QF26IMW5.js";import{a as _}from"./K5ER32GO.js";import"./VWPZQJYL.js";import{a as N}from"./DPYBYBEF.js";import{a as U}from"./YYHJZZWX.js";import"./UJ65GBAZ.js";import"./ERWBUKL2.js";import"./XGOXGDN5.js";import"./M5T7JFYC.js";import"./X537KRFU.js";import{B as R,C as z,D as M,E as k,I as E,Q as V,g as P,h as I,l as y,o as b}from"./GE2YDIDY.js";var ae={offset:"offset"},se={labelContent:"label-content"},ie=60;function O(t){return t.replace(":15",".25").replace(":30",".5").replace(":45",".75").replace("\u2212","-")}function ne(t,e){let o=L(t,"en-US",e).replace("GMT","");return o===""?0:Number(O(o))*ie}function le(){return new Date().getTimezoneOffset()*-1}function re(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}async function ce(t){if(t==="offset")return o=>o;let{normalize:e}=await import("./AXQNYCCP.js");return e}async function me(t,e,o,a,s){if(o==="name"){let{groupByName:i}=await import("./TCWQ3AQJ.js");return(await i()).map(({label:n})=>({label:n,value:n,metadata:{filterValue:n}})).filter(n=>!!n).sort()}let l=s==="user"?t:s==="utc"?"fr":"en-GB",h=a.getTime();if(o==="region"){let[{groupByRegion:i},{getCountry:c,global:n}]=await Promise.all([import("./JU3VCMK3.js"),import("./IDBJ5P6E.js")]);return(await i()).map(({label:m,tzs:d})=>(d.sort((u,f)=>{let v=T(u,e),x=T(f,e),p="Etc/GMT";if(u.startsWith(p)&&f.startsWith(p)){let g=u.substring(p.length),D=f.substring(p.length),oe=g===""?0:parseInt(g);return(D===""?0:parseInt(D))-oe}return v.localeCompare(x)}),{label:S(e,m),items:d.map(u=>{let f=O(L(u,l,h)),v=T(u,e),x=m===n?`${T(n,e)} Etc`:Y(u),p=c(u),g=S(e,p);return{label:v,value:u,metadata:{country:g===v?void 0:g,filterValue:x,offset:f}}})})).sort((m,d)=>m.label===n?-1:d.label===n?1:m.label.localeCompare(d.label))}let[{groupByOffset:C},{DateEngine:Z}]=await Promise.all([import("./MCX55DKQ.js"),import("./U3ZEHD7M.js")]),B=await C({dateEngine:new Z,groupDateRange:1,startDate:new Date(h).toISOString()}),te=new Intl.ListFormat(t,{style:"long",type:"conjunction"}),F=["Factory","Etc/UTC"];return B.forEach(i=>{let c=[],n=0;i.tzs.forEach((r,m)=>{F.includes(r)&&n++,c[m]=n}),i.tzs=i.tzs.filter(r=>!F.includes(r)),i.labelTzIdx=i.labelTzIdx.map(r=>r-c[r]).filter(r=>r>=0&&r<i.tzs.length)}),B.map(({labelTzIdx:i,tzs:c})=>{let n=c[0],r=O(L(n,l,h)),m=ne(n,h),d=i.map(f=>T(c[f],e));return{label:he(e,r,te.format(d)),value:m,metadata:{filterValue:c.map(f=>Y(f))}}}).filter(i=>!!i).sort((i,c)=>i.value-c.value)}function T(t,e){return e[t]||fe(t)}function ue(t,e,o){return o.timeZoneRegionLabel.replace("{city}",t).replace("{country}",S(o,e))}function S(t,e){return t[e]||e}function fe(t){return t.split("/").pop()}function Y(t){return t.replace(/_/g," ")}function he(t,e,o){return t.timeZoneLabel.replace("{offset}",e).replace("{cities}",o)}function L(t,e,o=Date.now()){return t==="Factory"&&(t="Etc/GMT"),K(e,{timeZone:t,timeZoneName:"shortOffset"}).formatToParts(o).find(({type:l})=>l==="timeZoneName").value}function de(t){return t[0].items!==void 0}function pe(t){return de(t)?t.flatMap(e=>e.items):t}function ee(t,e,o){return o==null?null:pe(t).find(a=>a[e]==o)}var be=P`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}.offset{white-space:nowrap}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}::slotted(input[slot=hidden-form-input]){margin:0!important;opacity:0!important;outline:none!important;padding:0!important;position:absolute!important;inset:0!important;transform:none!important;-webkit-appearance:none!important;z-index:-1!important}`,w=class extends M{constructor(){super(...arguments),this.comboboxRef=R(),this.messages=N({blocking:!0}),this.focusSetter=U()(this),this.clearable=!1,this.disabled=!1,this.maxItems=0,this.mode="offset",this.offsetStyle="user",this.open=!1,this.overlayPositioning="absolute",this.readOnly=!1,this.required=!1,this.scale="m",this.status="idle",this.validity={valid:!1,badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1},this.calciteInputTimeZoneBeforeClose=b({cancelable:!1}),this.calciteInputTimeZoneBeforeOpen=b({cancelable:!1}),this.calciteInputTimeZoneChange=b({cancelable:!1}),this.calciteInputTimeZoneClose=b({cancelable:!1}),this.calciteInputTimeZoneOpen=b({cancelable:!1})}static{this.properties={clearable:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],form:[3,{},{reflect:!0}],labelText:1,maxItems:[11,{},{reflect:!0,type:Number}],messageOverrides:[0,{},{attribute:!1}],mode:[3,{},{reflect:!0}],name:[3,{},{reflect:!0}],offsetStyle:[3,{},{reflect:!0}],open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],readOnly:[7,{},{reflect:!0,type:Boolean}],referenceDate:1,required:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],status:[3,{},{reflect:!0}],validationIcon:[3,{converter:E},{reflect:!0}],validationMessage:1,validity:[0,{},{attribute:!1}],value:1}}static{this.shadowRootOptions={mode:"open",delegatesFocus:!0}}static{this.styles=be}get value(){return this._value}set value(e){this._value=e}async setFocus(e){return this.focusSetter(()=>this.comboboxRef.value,e)}connectedCallback(){super.connectedCallback(),H(this),J(this)}async load(){this.normalizer=await ce(this.mode),await this.updateTimeZoneItems();let e=this.value,o=this.normalizeValue(e);this.value=o||(e===""?o:void 0),this.updateTimeZoneSelection();let a=this.selectedTimeZoneItem?`${this.selectedTimeZoneItem.value}`:"";j(this,a),this.value=a}willUpdate(e){e.has("value")&&this.hasUpdated&&this.handleValueChange(this.value,e.get("value")),(e.has("messages")||e.has("mode")&&(this.hasUpdated||this.mode!=="offset")||e.has("referenceDate"))&&this.handleTimeZoneItemPropsChange(),e.has("open")&&(this.hasUpdated||this.open!==!1)&&this.openChanged()}updated(){G(this)}loaded(){this.openChanged()}disconnectedCallback(){super.disconnectedCallback(),W(this),Q(this)}async handleTimeZoneItemPropsChange(){!this.timeZoneItems||!this.hasUpdated||(await this.updateTimeZoneItems(),this.updateTimeZoneSelection())}openChanged(){this.comboboxRef.value&&(this.comboboxRef.value.open=this.open)}async handleValueChange(e,o){let a=this.normalizeValue(e);if(!a){if(this.clearable){this._value=a,this.selectedTimeZoneItem=null;return}this._value=o,this.selectedTimeZoneItem=this.findTimeZoneItem(o);return}let s=this.findTimeZoneItem(a);if(!s){this._value=o;return}this._value=a,this.selectedTimeZoneItem=s}onLabelClick(){this.setFocus()}overrideSelectedLabelForRegion(e){this.mode!=="region"||!this.selectedTimeZoneItem||(this.comboboxRef.value.selectedItems[0].textLabel=this.getItemLabel(this.selectedTimeZoneItem,e))}onComboboxBeforeClose(e){e.stopPropagation(),this.overrideSelectedLabelForRegion(!1),this.calciteInputTimeZoneBeforeClose.emit()}onComboboxBeforeOpen(e){e.stopPropagation(),this.overrideSelectedLabelForRegion(!0),this.calciteInputTimeZoneBeforeOpen.emit()}onComboboxChange(e){e.stopPropagation();let a=e.target.selectedItems[0];if(!a){this._value="",this.selectedTimeZoneItem=null,this.calciteInputTimeZoneChange.emit();return}let s=this.findTimeZoneItemByLabel(a.getAttribute("data-label")),l=`${s.value}`;this.value===l&&s.label===this.selectedTimeZoneItem.label||(this._value=l,this.selectedTimeZoneItem=s,this.calciteInputTimeZoneChange.emit())}onComboboxClose(e){e.stopPropagation(),this.open=!1,this.calciteInputTimeZoneClose.emit()}onComboboxOpen(e){this.open=!0,e.stopPropagation(),this.calciteInputTimeZoneOpen.emit()}findTimeZoneItem(e){return ee(this.timeZoneItems,"value",e)}findTimeZoneItemByLabel(e){return ee(this.timeZoneItems,"label",e)}async updateTimeZoneItems(){this.timeZoneItems=await this.createTimeZoneItems()}updateTimeZoneSelection(){if(this.value===""&&this.clearable){this.selectedTimeZoneItem=null;return}let e=this.mode==="offset"?le():re(),o=this.value===""||!this.value?e:this.value;this.selectedTimeZoneItem=this.findTimeZoneItem(o)||this.findTimeZoneItem(e)}async createTimeZoneItems(){return!this.messages._lang||!this.messages?[]:me(this.messages._lang,this.messages,this.mode,this.referenceDate instanceof Date?this.referenceDate:new Date(this.referenceDate??Date.now()),this.offsetStyle)}normalizeValue(e){return e=e===void 0?"":e,e&&this.normalizer(e)}getItemLabel(e,o=this.open){let a=this.selectedTimeZoneItem===e,{label:s,metadata:l}=e;return!l.country||o||!a?s:ue(s,l.country,this.messages)}render(){return q({disabled:this.disabled,children:I`<calcite-combobox .clearDisabled=${!this.clearable} .disabled=${this.disabled} .label=${this.messages.chooseTimeZone} .labelText=${this.labelText} lang=${this.messages._lang??y} .maxItems=${this.maxItems} @calciteComboboxBeforeClose=${this.onComboboxBeforeClose} @calciteComboboxBeforeOpen=${this.onComboboxBeforeOpen} @calciteComboboxChange=${this.onComboboxChange} @calciteComboboxClose=${this.onComboboxClose} @calciteComboboxOpen=${this.onComboboxOpen} .overlayPositioning=${this.overlayPositioning} .placeholder=${this.mode==="name"?this.messages.namePlaceholder:this.mode==="offset"?this.messages.offsetPlaceholder:this.messages.regionPlaceholder} placeholder-icon=search .readOnly=${this.readOnly} .required=${this.required} .scale=${this.scale} .selectionMode=${this.clearable?"single":"single-persist"} .status=${this.status} .validationIcon=${this.validationIcon} .validationMessage=${this.validationMessage} ${z(this.comboboxRef)}>${this.renderItems()}<slot name=${se.labelContent} slot=${X.labelContent}></slot></calcite-combobox>${A({component:this})}`})}renderItems(){return this.mode==="region"?this.renderRegionItems():$(this.timeZoneItems,({label:e})=>e,e=>{let o=this.selectedTimeZoneItem===e,{label:a,metadata:s,value:l}=e;return I`<calcite-combobox-item data-label=${a??y} .metadata=${s} .selected=${o} .textLabel=${a} .value=${l}></calcite-combobox-item>`})}renderRegionItems(){return this.timeZoneItems.flatMap(({label:e,items:o})=>_(e,I`<calcite-combobox-item-group .label=${e}>${$(o,({label:a})=>a,a=>{let s=this.selectedTimeZoneItem===a,{label:l,metadata:h,value:C}=a,Z=this.getItemLabel(a);return I`<calcite-combobox-item data-label=${l??y} .description=${h.country} .metadata=${h} .selected=${s} .textLabel=${Z} .value=${C}><span class=${k(ae.offset)} slot=content-end>${h.offset}</span></calcite-combobox-item>`})}</calcite-combobox-item-group>`))}};V("calcite-input-time-zone",w);export{w as InputTimeZone};
