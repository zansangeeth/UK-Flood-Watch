{"version":3,"file":"Indicator.js","sourceRoot":"","sources":["../../../../../../src/.internal/charts/stock/indicators/Indicator.ts"],"names":[],"mappings":"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","sourcesContent":["import type { XYSeries, IXYSeriesDataItem } from \"../../xy/series/XYSeries\";\r\nimport type { StockLegend } from \"../StockLegend\";\r\nimport type { StockChart } from \"../StockChart\";\r\nimport type { DataItem } from \"../../../core/render/Component\";\r\nimport type { Color } from \"../../../core/util/Color\";\r\n\r\nimport { Container, IContainerSettings, IContainerPrivate, IContainerEvents } from \"../../../core/render/Container\";\r\nimport { LineSeries } from \"../../xy/series/LineSeries\";\r\nimport { BaseColumnSeries } from \"../../xy/series/BaseColumnSeries\";\r\nimport { MultiDisposer } from \"../../../core/util/Disposer\";\r\n\r\nimport * as $array from \"../../../core/util/Array\";\r\n\r\nexport interface IIndicatorEditableSetting {\r\n\r\n\t/**\r\n\t * Setting key.\r\n\t */\r\n\tkey: string;\r\n\r\n\t/**\r\n\t * Name of the setting (displayed in edit modal).\r\n\t *\r\n\t * Settings with the same name will be grouped in modal.\r\n\t */\r\n\tname: string;\r\n\r\n\t/**\r\n\t * Type of the control to show for editing the setting in modal.\r\n\t */\r\n\ttype: \"color\" | \"number\" | \"dropdown\" | \"checkbox\" | \"text\";\r\n\r\n\t/**\r\n\t * Minimum numeric value allowable in this field.\r\n\t *\r\n\t * @since 5.8.1\r\n\t */\r\n\tminValue?: number;\r\n\r\n\t/**\r\n\t * If `type: \"dropdown\"`, `options` should contain a list of items it.\r\n\t */\r\n\toptions?: Array<string | {\r\n\t\tvalue: number | string,\r\n\t\ttext: string,\r\n\t\textTarget?: string,\r\n\t\textTargetValue?: number | string,\r\n\t\textTargetMinValue?: number\r\n\t}>;\r\n\r\n}\r\n\r\nexport interface IIndicatorSettings extends IContainerSettings {\r\n\r\n\t/**\r\n\t * An instance of target [[StockChart]].\r\n\t */\r\n\tstockChart: StockChart;\r\n\r\n\t/**\r\n\t * A main series indicator will be based on.\r\n\t */\r\n\tstockSeries: XYSeries;\r\n\r\n\t/**\r\n\t * A volume series indicator will be based on, if it reaquires one.\r\n\t */\r\n\tvolumeSeries?: XYSeries;\r\n\r\n\t/**\r\n\t * If set to a reference to [[StockLegend]], indicator will add itself into\r\n\t * the legend.\r\n\t */\r\n\tlegend?: StockLegend;\r\n\r\n\t/**\r\n\t * Period.\r\n\t */\r\n\tperiod?: number;\r\n\r\n\t/**\r\n\t * A value field to use.\r\n\t */\r\n\tfield?: \"open\" | \"close\" | \"low\" | \"high\" | \"hl/2\" | \"hlc/3\" | \"hlcc/4\" | \"ohlc/4\";\r\n\r\n\t/**\r\n\t * Indicator name, e.g. \"Moving Average\".\r\n\t */\r\n\tname?: string;\r\n\r\n\t/**\r\n\t * Short name for the indicator, e.g. \"MA\" (for \"Moving Average\").\r\n\t *\r\n\t * Mainly used for the legend.\r\n\t */\r\n\tshortName?: string;\r\n\r\n\t/**\r\n\t * A color to use for the indicator series.\r\n\t */\r\n\tseriesColor?: Color;\r\n\r\n\t/**\r\n\t * Should indicator settings modal be openend automatically when indicator\r\n\t * is added to a chart via [[IndicatorControl]].\r\n\t *\r\n\t * @default true\r\n\t * @since 5.10.6\r\n\t */\r\n\tautoOpenSettings?: boolean;\r\n\r\n}\r\n\r\nexport interface IIndicatorPrivate extends IContainerPrivate {\r\n}\r\n\r\nexport interface IIndicatorEvents extends IContainerEvents {\r\n}\r\n\r\n/**\r\n * Base class for [[StockChart]] indicators.\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v5/charts/stock/indicators/} for more info\r\n */\r\nexport abstract class Indicator extends Container {\r\n\tpublic static className: string = \"Indicator\";\r\n\tpublic static classNames: Array<string> = Container.classNames.concat([Indicator.className]);\r\n\r\n\tdeclare public _settings: IIndicatorSettings;\r\n\tdeclare public _privateSettings: IIndicatorPrivate;\r\n\tdeclare public _events: IIndicatorEvents;\r\n\r\n\tpublic _editableSettings: IIndicatorEditableSetting[] = [];\r\n\r\n\tpublic series!: XYSeries;\r\n\r\n\tprotected _dataDirty = false;\r\n\r\n\tprotected _sDP?: MultiDisposer;\r\n\tprotected _vDP?: MultiDisposer;\r\n\r\n\tpublic _prepareChildren() {\r\n\t\tsuper._prepareChildren();\r\n\r\n\t\tif (this.isDirty(\"stockSeries\") || this.isDirty(\"volumeSeries\")) {\r\n\t\t\tthis.markDataDirty();\r\n\r\n\t\t\tconst stockSeries = this.get(\"stockSeries\");\r\n\t\t\tconst previousS = this._prevSettings.stockSeries;\r\n\t\t\tif (previousS && this._sDP) {\r\n\t\t\t\tthis._sDP.dispose();\r\n\t\t\t}\r\n\t\t\tif (stockSeries) {\r\n\t\t\t\tthis._sDP = new MultiDisposer([\r\n\t\t\t\t\tstockSeries.events.on(\"datavalidated\", () => {\r\n\t\t\t\t\t\tthis._markDataDirty();\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tstockSeries.events.on(\"datasetchanged\", () => {\r\n\t\t\t\t\t\tthis._markDataDirty();\r\n\t\t\t\t\t})\r\n\t\t\t\t])\r\n\t\t\t}\r\n\r\n\t\t\tconst previousV = this._prevSettings.volumeSeries;\r\n\t\t\tif (previousV && this._vDP) {\r\n\t\t\t\tthis._vDP.dispose();\r\n\t\t\t}\r\n\t\t\tconst volumeSeries = this.get(\"volumeSeries\");\r\n\t\t\tif (volumeSeries) {\r\n\t\t\t\tthis._vDP = new MultiDisposer([\r\n\t\t\t\t\tvolumeSeries.events.on(\"datavalidated\", () => {\r\n\t\t\t\t\t\tthis._markDataDirty();\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tvolumeSeries.events.on(\"datasetchanged\", () => {\r\n\t\t\t\t\t\tthis._markDataDirty();\r\n\t\t\t\t\t})\r\n\t\t\t\t])\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.isDirty(\"field\")) {\r\n\t\t\tif (this.get(\"field\")) {\r\n\t\t\t\tthis.markDataDirty();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.isDirty(\"period\")) {\r\n\t\t\tthis.markDataDirty();\r\n\t\t\tthis.setCustomData(\"period\", this.get(\"period\"));\r\n\t\t}\r\n\r\n\r\n\t\tif (this._dataDirty) {\r\n\t\t\tthis.prepareData();\r\n\t\t\tthis._dataDirty = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _markDataDirty() {\r\n\t\tthis._dataDirty = true;\r\n\t\tthis.markDirty();\r\n\t}\r\n\r\n\tpublic markDataDirty() {\r\n\t\tthis._root.events.once(\"frameended\", () => {\r\n\t\t\tthis._markDataDirty();\r\n\t\t})\r\n\t}\r\n\r\n\tpublic _updateChildren() {\r\n\t\tsuper._updateChildren();\r\n\r\n\t\tif (this.isDirty(\"seriesColor\")) {\r\n\t\t\tthis._updateSeriesColor(this.series, this.get(\"seriesColor\"), \"seriesColor\");\r\n\t\t}\r\n\r\n\t\tthis.setCustomData(\"period\", this.get(\"period\"));\r\n\t\tthis.setCustomData(\"field\", this.get(\"field\"));\r\n\t\tthis.setCustomData(\"name\", this.get(\"name\"));\r\n\t\tthis.setCustomData(\"shortName\", this.get(\"shortName\"));\r\n\t}\r\n\r\n\tprotected _dispose() {\r\n\t\tsuper._dispose();\r\n\r\n\t\tif (this._sDP) {\r\n\t\t\tthis._sDP.dispose();\r\n\t\t}\r\n\t\tif (this._vDP) {\r\n\t\t\tthis._vDP.dispose();\r\n\t\t}\r\n\r\n\t\tconst series = this.series;\r\n\t\tif (series) {\r\n\t\t\tseries.dispose();\r\n\r\n\t\t\tconst yAxis = series.get(\"yAxis\");\r\n\t\t\tif (yAxis) {\r\n\t\t\t\tyAxis.markDirtySelectionExtremes();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst stockChart = this.get(\"stockChart\");\r\n\t\tif (stockChart) {\r\n\t\t\tconst legend = this.get(\"legend\");\r\n\t\t\tif (legend) {\r\n\t\t\t\tconst legendDataItem = series.get(\"legendDataItem\");\r\n\t\t\t\tif (legendDataItem) {\r\n\t\t\t\t\tlegend.disposeDataItem(legendDataItem as any);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstockChart.indicators.removeValue(this);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async hide(duration?: number): Promise<any> {\r\n\t\treturn Promise.all([\r\n\t\t\tsuper.hide(duration),\r\n\t\t\tthis.series.hide(duration)\r\n\t\t]);\r\n\t}\r\n\r\n\tpublic async show(duration?: number): Promise<any> {\r\n\t\treturn Promise.all([\r\n\t\t\tsuper.show(duration),\r\n\t\t\tthis.series.show(duration)\r\n\t\t]);\r\n\t}\r\n\r\n\tprotected _handleLegend(series: XYSeries) {\r\n\t\tconst legend = this.get(\"legend\");\r\n\t\tif (legend) {\r\n\t\t\tlegend.data.push(series);\r\n\r\n\t\t\tconst legendDataItem = legend.dataItems[legend.dataItems.length - 1];\r\n\t\t\tlegendDataItem.get(\"marker\").set(\"forceHidden\", true);\r\n\r\n\t\t\tconst closeButton = legendDataItem.get(\"closeButton\");\r\n\t\t\tcloseButton.set(\"forceHidden\", false);\r\n\t\t\tcloseButton.events.on(\"click\", () => {\r\n\t\t\t\tthis.dispose();\r\n\t\t\t})\r\n\r\n\t\t\tconst settingsButton = legendDataItem.get(\"settingsButton\");\r\n\t\t\tsettingsButton.setPrivate(\"customData\", this);\r\n\r\n\t\t\tconst editableSettings = this._editableSettings;\r\n\t\t\tif (!editableSettings || editableSettings.length == 0) {\r\n\t\t\t\tsettingsButton.set(\"forceHidden\", true);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _updateSeriesColor(series?: XYSeries, color?: Color, contextName?: string) {\r\n\t\tif (series) {\r\n\t\t\tseries.set(\"stroke\", color);\r\n\t\t\tseries.set(\"fill\", color);\r\n\t\t\tif (series instanceof LineSeries) {\r\n\t\t\t\tseries.strokes.template.set(\"stroke\", color);\r\n\t\t\t\tseries.fills.template.set(\"fill\", color);\r\n\t\t\t}\r\n\r\n\t\t\tif (series instanceof BaseColumnSeries) {\r\n\t\t\t\tseries.columns.template.setAll({ stroke: color, fill: color });\r\n\t\t\t}\r\n\r\n\t\t\tif (contextName && color) {\r\n\t\t\t\tthis.setCustomData(contextName, color.toCSSHex());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tpublic setCustomData(name: string, value?: any) {\r\n\t\tconst customData = this.series.getPrivate(\"customData\");\r\n\t\tif (customData) {\r\n\t\t\tcustomData[name] = value;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic prepareData() {\r\n\r\n\t}\r\n\r\n\tprotected _getValue(dataItem: DataItem<IXYSeriesDataItem>): number | undefined {\r\n\t\tconst field = this.get(\"field\");\r\n\r\n\t\tlet o = dataItem.get(\"openValueY\") as number;\r\n\t\tlet h = dataItem.get(\"highValueY\") as number;\r\n\t\tlet l = dataItem.get(\"lowValueY\") as number;\r\n\t\tlet c = dataItem.get(\"valueY\") as number;\r\n\r\n\t\tswitch (field) {\r\n\t\t\tcase \"close\":\r\n\t\t\t\treturn c;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"open\":\r\n\t\t\t\treturn o;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"high\":\r\n\t\t\t\treturn h;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"low\":\r\n\t\t\t\treturn l;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hl/2\":\r\n\t\t\t\treturn (h + l) / 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hlc/3\":\r\n\t\t\t\treturn (h + l + c) / 3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"hlcc/4\":\r\n\t\t\t\treturn (h + l + c + c) / 4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ohlc/4\":\r\n\t\t\t\treturn (o + h + l + c) / 4;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected _getDataArray(dataItems: Array<DataItem<any>>): Array<any> {\r\n\t\tconst data: Array<any> = [];\r\n\t\t$array.each(dataItems, (dataItem) => {\r\n\t\t\tdata.push({ valueX: dataItem.get(\"valueX\"), value_y: this._getValue(dataItem) });\r\n\t\t})\r\n\t\treturn data;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected _getTypicalPrice(dataItems: Array<DataItem<any>>): Array<any> {\r\n\t\tconst data: Array<any> = [];\r\n\t\t$array.each(dataItems, (dataItem) => {\r\n\t\t\tdata.push({ valueX: dataItem.get(\"valueX\"), value_y: (dataItem.get(\"valueY\", 0) + dataItem.get(\"highValueY\", 0) + dataItem.get(\"lowValueY\", 0)) / 2 });\r\n\t\t})\r\n\t\treturn data;\r\n\t}\r\n\r\n\r\n\tprotected _sma(data: Array<any>, period: number, field: string, toField: string) {\r\n\t\tif (!data || data.length === 0 || period <= 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst invPeriod = 1 / period;\r\n\t\tconst len = data.length;\r\n\r\n\t\tlet count = 0; // number of non-null values encountered\r\n\t\tlet sum = 0;   // sum of values in the current window\r\n\r\n\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\tconst dataItem = data[i];\r\n\t\t\tconst value = dataItem[field];\r\n\r\n\t\t\tif (value != null) {\r\n\t\t\t\tcount++;\r\n\t\t\t\tsum += value;\r\n\r\n\t\t\t\t// remove value that goes out of window (by index, to preserve original behavior)\r\n\t\t\t\tif (count > period) {\r\n\t\t\t\t\tconst valueToRemove = data[i - period][field];\r\n\t\t\t\t\tif (valueToRemove != null) {\r\n\t\t\t\t\t\tsum -= valueToRemove;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (count >= period) {\r\n\t\t\t\t\tdataItem[toField] = sum * invPeriod;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _wma(data: Array<any>, period: number, field: string, toField: string) {\r\n\t\tconst denom = period * (period + 1) / 2;\r\n\t\tconst buffer: number[] = new Array(period);\r\n\t\tlet start = 0;\r\n\t\tlet len = 0;\r\n\t\tlet sum = 0;      // sum of values in the window\r\n\t\tlet weighted = 0; // weighted sum (1*v1 + 2*v2 + ... + p*vp)\r\n\r\n\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\tconst dataItem = data[i];\r\n\t\t\tconst value = dataItem[field];\r\n\r\n\t\t\tif (value == null) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (len < period) {\r\n\r\n\t\t\t\tconst pos = (start + len) % period;\r\n\t\t\t\tbuffer[pos] = value;\r\n\t\t\t\tlen++;\r\n\t\t\t\tsum += value;\r\n\t\t\t\tweighted += len * value;\r\n\r\n\t\t\t\tif (len === period) {\r\n\t\t\t\t\tdataItem[toField] = weighted / denom;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconst oldest = buffer[start];\r\n\t\t\t\tweighted = weighted - sum + period * value;\r\n\t\t\t\tsum = sum - oldest + value;\r\n\t\t\t\tbuffer[start] = value;\r\n\t\t\t\tstart = (start + 1) % period;\r\n\t\t\t\tdataItem[toField] = weighted / denom;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprotected _ema(data: Array<any>, period: number, field: string, toField: string) {\r\n\t\tconst len = data.length;\r\n\t\tif (len === 0 || period <= 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst invPeriod = 1 / period;\r\n\t\tconst multiplier = 2 / (1 + period);\r\n\t\tconst oneMinus = 1 - multiplier;\r\n\r\n\t\tlet ma = 0;\r\n\t\tlet count = 0;\r\n\r\n\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\tconst dataItem = data[i];\r\n\t\t\tconst value = dataItem[field];\r\n\r\n\t\t\tif (value == null) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tcount++;\r\n\r\n\t\t\tif (count > period) {\r\n\t\t\t\tma = value * multiplier + ma * oneMinus;\r\n\t\t\t\tdataItem[toField] = ma;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tma += value * invPeriod;\r\n\t\t\t\tif (count === period) {\r\n\t\t\t\t\tdataItem[toField] = ma;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _dema(data: Array<any>, period: number, field: string, toField: string) {\r\n\t\tif (period <= 0 || data.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst multiplier = 2 / (1 + period);\r\n\t\tconst oneMinus = 1 - multiplier;\r\n\t\tconst invPeriod = 1 / period;\r\n\r\n\t\tlet ema = 0;\r\n\t\tlet emaCount = 0;\r\n\r\n\t\tlet ema2 = 0;\r\n\t\tlet ema2Count = 0;\r\n\r\n\t\tfor (let i = 0, len = data.length; i < len; i++) {\r\n\t\t\tconst dataItem = data[i];\r\n\t\t\tconst value = dataItem[field];\r\n\r\n\t\t\tif (value == null) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// compute EMA (same logic as _ema)\r\n\t\t\temaCount++;\r\n\t\t\tif (emaCount > period) {\r\n\t\t\t\tema = value * multiplier + ema * oneMinus;\r\n\t\t\t\tdataItem.ema = ema;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tema += value * invPeriod;\r\n\t\t\t\tif (emaCount === period) {\r\n\t\t\t\t\tdataItem.ema = ema;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// if EMA was produced for this item, update EMA of EMA (ema2) and DEMA\r\n\t\t\tconst emaVal = dataItem.ema;\r\n\t\t\tif (emaVal != null) {\r\n\t\t\t\tema2Count++;\r\n\t\t\t\tif (ema2Count > period) {\r\n\t\t\t\t\tema2 = emaVal * multiplier + ema2 * oneMinus;\r\n\t\t\t\t\tdataItem[toField] = 2 * emaVal - ema2;\r\n\t\t\t\t\tdataItem.ema2 = ema2;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tema2 += emaVal / period;\r\n\t\t\t\t\tif (ema2Count === period) {\r\n\t\t\t\t\t\tdataItem[toField] = 2 * emaVal - ema2;\r\n\t\t\t\t\t\tdataItem.ema2 = ema2;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _tema(data: Array<any>, period: number, field: string, toField: string) {\r\n\t\tif (period <= 0 || data.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst multiplier = 2 / (1 + period);\r\n\t\tconst oneMinus = 1 - multiplier;\r\n\r\n\t\t// Ensure ema and ema2 are present\r\n\t\tthis._dema(data, period, field, \"dema\");\r\n\r\n\t\tlet ema3 = 0;\r\n\t\tlet count = 0;\r\n\t\tfor (let i = 0, len = data.length; i < len; i++) {\r\n\t\t\tconst dataItem = data[i];\r\n\t\t\tconst ema = dataItem.ema;\r\n\t\t\tconst ema2 = dataItem.ema2;\r\n\r\n\t\t\tif (ema2 == null) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tcount++;\r\n\t\t\tif (count > period) {\r\n\t\t\t\tema3 = ema2 * multiplier + ema3 * oneMinus;\r\n\t\t\t\t// guard ema just in case (should be present when ema2 is)\r\n\t\t\t\tconst emaVal = (ema == null) ? 0 : ema;\r\n\t\t\t\tdataItem[toField] = 3 * emaVal - 3 * ema2 + ema3;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tema3 += ema2 / period;\r\n\t\t\t\tif (count === period) {\r\n\t\t\t\t\tconst emaVal = (ema == null) ? 0 : ema;\r\n\t\t\t\t\tdataItem[toField] = 3 * emaVal - 3 * ema2 + ema3;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n"]}